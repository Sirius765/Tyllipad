Импорт из Тиллипад

- Загрузка актов-реализаций #акт-реализация
  - Создание документа Реализация
    - Как определить контрагента? Есть ли контрагент в акте-реализации? Проверил - нету. Задаем контрагента через настройку.
    - Загрузка строк. Не находит номенклатуру даже после синхронизации. 
      - Как выполняется отбор номенклатуры для синхронизации? Вот запрос: 
        "SELECT ProductItems.pitm_ID, ProductItems.pitm_name, ProductItems.pitm_pgrp_ID, ProductItems.pitm_meit_ID
        FROM ProductItems
        WHERE pitm_del_ID IS NULL"
      - Также есть запросы для групп и они добавлены в общие запросы. Это кстати я добавлял в свое время. Как происходит связывание товара ТП и 1С?
        "В процедуре СоздатьЭлементыСправочника есть вызов ВнешнийОбъект.SetReferenceLink(Строка(Элемент.Ссылка.УникальныйИдентификатор()));"
      - Похоже ссылка сохраняется, но почему-то не попадает в регистр соответствия номенклатуры. Проверить как и где он заполняется. Похоже обработкой. Тогда включить ее в работу при загрузке справочников.
        "Обработка берет УИДЫ из макета, а в макет они загружены из SQL Managment Studio, т.к. база Export1Cv82 к 1С не подключена. По хорошему ее нужно подключить. Связи хранятся в таблице ReferenceLinks. Получил свежую выборку кодов запросом: SELECT     dbo.ReferenceLinks.refl_TP_ID, dbo.ReferenceLinks.refl_1C_ID, dbo.ObjectTypes.objt_Name
        FROM         dbo.ReferenceLinks INNER JOIN
                              dbo.ObjectTypes ON dbo.ReferenceLinks.refl_objt_ID = dbo.ObjectTypes.objt_ID
        WHERE     (dbo.ObjectTypes.objt_Name = N'Номенклатура') AND (NOT (dbo.ReferenceLinks.refl_1C_ID LIKE '00000000-0000-0000-0000-000000000000'))
        но Картофель фри там отсутствует почему-то. Т.к. времени разбираться нет подправил пока функцию поиска номенклатуры по наименованию, чтобы возвращала ссылку на первый нйденный элемент если их больше одного."
      - Добавил в настройки ресурс АктРеализация_ТипЦен, для указания цен продажи в документе реализации.
- Доработка формы настройки
  - Убрать лишнее
  - Добавить настройки:
    - Контрагент для акта-реализации #акт-реализация 
      "Добавил в РС НастройкиTP ресурс "АктРеализация_Контрагент", вывел в форму настроек"
    - Тип цен для акта-реализации #акт-реализация 
      "Добавил в РС НастройкиTP ресурс "АктРеализация_ТипЦен", вывел в форму настроек"
- Загрузка актов-списаний #акт-списание
  - создается несколько ед.изм #ошибка
    "Исправлено"
- Загрузка накладных-перемещений  #накладная-перемещение
  - Есть два вида накладных: накладные перемещения со складов и накладные перемещения на склады. Но они почему-то содержат одни и те-же документы.
  - Слепил такой запрос:
    "SELECT mdoc_ID, mdoc_usr_ID
    INTO #MoveDocuments
    FROM MoveDocuments
    JOIN MoveDocumentItems ON mdoc_ID = mdit_mdoc_ID
    JOIN StoreEngine ON sten_Item_ID = mdit_ID
    JOIN %IncludeStores S_In ON mdoc_stor_ID_In = S_In.stor_ID
    JOIN %IncludeStores S_Out ON mdoc_stor_ID_Out = S_Out.stor_ID
    WHERE mdoc_Date >= %DateBegin AND mdoc_Date < %DateEnd
    	AND mdoc_mdst_ID = 1 
      AND mdit_mdit_ID_Parent IS NULL AND (mdit_IsDeleted = 0 OR (mdit_serc_ID_In <> 0 AND mdit_serc_ID_Out <> 0))
    GROUP BY mdoc_ID, mdoc_stor_ID_In, mdoc_stor_ID_Out, mdoc_usr_ID
    
    
    
    -- Заголовок
    SELECT  D.mdoc_ID, D.mdoc_Name 'ДокументИмя', D.mdoc_Date 'Дата', D.mdoc_stor_ID_Out 'Отправитель', D.mdoc_stor_ID_In 'Получатель', stgr_part_ID 'Организация'
    	, 'накладная перемещение Тиллипад "'+D.mdoc_Name+'"' 'Комментарий'
    FROM MoveDocuments D
    JOIN #MoveDocuments M ON D.mdoc_ID = M.mdoc_ID
    JOIN Stores S_In ON D.mdoc_stor_ID_In = S_In.stor_ID
    JOIN Stores S_Out ON D.mdoc_stor_ID_Out = S_Out.stor_ID
    JOIN StoreGroups ON S_In.stor_stgr_ID = stgr_ID
    ORDER BY mdoc_Date"
  - Еще можно вручную сопоставлять склады, номенклатуру и прочее
  - При подключении в торговле дополнительных таблиц возникла странная ошибка: ИД таблицы при замене типа на строку не предлагал указать длину строки и после подключения запросы не работали. Это наблюдалось на компьютере SUN, где стоит рабочая торговля. При подключении на компьютере CAFEBUHG все нормально подключилось, после чего обновил конфигурацию на рабочей торговле. С чем это связано пока не знаю.
- Загрузка поступлений #поступление-товара
  - При загрузке поступлений не подгрузилась часть номенклатуры. Оказывается это из-за того, что в настроечной базе хранилась связка с битой ссылкой. Почистил такие связки (объект не найден) и все загрузилось.